<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pomodoro Timer</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#10ac84">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1e1e2f, #2d2d44);
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e0e0e0;
    }

    .container {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 2rem;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
      text-align: center;
      color: #f1f1f1;
    }

    h1 {
      font-weight: 600;
      font-size: 2rem;
      margin-bottom: 1.5rem;
      color: #ffffff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    .progress-container {
      position: relative;
      width: 220px;
      height: 220px;
      margin: auto;
    }

    /* absolutely pin the SVG to fill the container */
    .progress-ring {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .progress-ring__background,
    .progress-ring__circle {
      fill: none;
      stroke-width: 12;
    }

    .progress-ring__background {
      stroke: rgba(255, 255, 255, 0.08);
    }

    .progress-ring__circle {
      stroke: #10ac84;
      stroke-linecap: round;
      stroke-dasharray: 628;
      stroke-dashoffset: 628;
      transition: stroke-dashoffset 0.5s linear, stroke 0.4s ease;
      filter: drop-shadow(0 0 8px rgba(16, 172, 132, 0.4));
    }

    /* absolutely center the time text */
    .time {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2.6rem;
      font-weight: 600;
      color: #ffffff;
      letter-spacing: 1px;
      text-shadow: 0 0 6px rgba(0, 0, 0, 0.5);
      pointer-events: none;
      text-align: center;
    }

    .buttons {
      margin-top: 1.8rem;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      background: rgba(255, 255, 255, 0.1);
      color: #f1f1f1;
      border: none;
      padding: 10px 16px;
      font-size: 1rem;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease;
      backdrop-filter: blur(6px);
      font-family: 'Poppins', sans-serif;
    }

    button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .modes {
      margin-top: 2.5rem;
      padding: 1.2rem 0;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .modes button {
      background: rgba(255, 255, 255, 0.08);
      color: #f1f1f1;
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 500;
      transition: background 0.3s ease;
    }

    .modes button:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .modes button.active {
      background: #f1f1f1;
      color: #1e1e2f;
      font-weight: 600;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }

    @media (max-width: 480px) {
      .progress-container {
        width: 180px;
        height: 180px;
      }
      .time {
        font-size: 2.2rem;
      }
      .modes button {
          padding: 7px 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Pomodoro Timer</h1>
    <audio id="alarm" src="Sound/clock-alarm-8761(1).mp3"></audio>
    <div class="progress-container">
      <svg class="progress-ring" viewBox="0 0 220 220">
        <circle class="progress-ring__background" cx="110" cy="110" r="100"/>
        <circle class="progress-ring__circle" cx="110" cy="110" r="100"/>
      </svg>
      <div class="time" id="timer">25:00</div>
    </div>

    <div class="buttons">
      <button onclick="showNotificationMessage(); startTimer()">Start</button>
      <button onclick="pauseTimer()">Pause</button>
      <button onclick="resetTimer()">Reset</button>
    </div>

    <div class="modes">
      <button onclick="setMode('pomodoro', event)" class="active">Pomodoro</button>
      <button onclick="setMode('shortBreak', event)">Short Break</button>
      <button onclick="setMode('longBreak', event)">Long Break</button>
    </div>
  </div>

  <script>
    window.alert("Hi there! Welcome to Pomodoro Timer 2.0, it now features a pop up notification and a sound alarm. Stay tuned for more updates, Thank You!");
    
    function showNotificationMessage() {
      if ("Notification" in window) {
          if (Notification.permission !=="granted" && Notification.permission !== "denied") {
               Notification.requestPermission().then(permission => {
                    console.log("Notification permission:", permission)
        })
      }
    }
  }
  
    // Enable Automatic Sound Unlock on first user interaction
    function unlockSound() {
      const alarm = document.getElementById('alarm')
      alarm.play().then(() => {
      alarm.pause();
      alarm.currentTime = 0
      })
          .catch(err => console.log('Sound is still locked', err))
    document.removeEventListener('click', unlockSound);}
   document.addEventListener('click', unlockSound)
    const timerDisplay = document.getElementById('timer');

    // Progress Ring
    const circle = document.querySelector('.progress-ring__circle');
    const radius = circle.r.baseVal.value;
    const circumference = 2 * Math.PI * radius;
    circle.style.strokeDasharray = circumference;
    circle.style.strokeDashoffset = circumference;

    let rafId = null;
    let endTime = null;
    let isRunning = false;
    let currentMode = 'pomodoro';
    const modeTimes = { pomodoro: 1500, shortBreak: 300, longBreak: 900};
    let remainingTime = modeTimes[currentMode];
    
   function updateDisplay() {
      const m = String(Math.floor(remainingTime/60)).padStart(2,'0');
      const s = String(remainingTime%60).padStart(2,'0');
      timerDisplay.textContent = `${m}:${s}`;
      circle.style.strokeDashoffset = circumference * (1 - remainingTime/modeTimes[currentMode]);
    }

    function tick() {
      const now = Date.now();
      remainingTime = Math.max(0, Math.ceil((endTime - now) / 1000))
      updateDisplay();

      if (remainingTime > 0 && isRunning) {
        rafId = requestAnimationFrame(tick);
      } else if (remainingTime === 0 && isRunning) {
          document.getElementById('alarm').play()
            if (navigator.serviceWorker.controller) {
              navigator.serviceWorker.controller.postMessage('Timer Up');
            }
        }
    }

   function startTimer() {
        if (!isRunning) {
       endTime = Date.now() + remainingTime * 1000;
       isRunning = true;
       tick()
    }
   }

   function pauseTimer() {
    if(isRunning) {
     isRunning = false; 
     if(rafId) cancelAnimationFrame(rafId);
     rafId = null

    }
   }

    function resetTimer() {
    pauseTimer();
    remainingTime = modeTimes[currentMode];
    updateDisplay();
  }
    
    function setMode(mode, e) {
      pauseTimer(); currentMode = mode; remainingTime = modeTimes[mode]; updateDisplay();
      document.querySelectorAll('.modes button').forEach (b=>b.classList.remove('active'));
      e.target.classList.add('active');
      const colors = { pomodoro:'#10ac84', shortBreak:'#00cec9', longBreak:'#6c5ce7' };
      circle.style.stroke = colors[mode];
    }   
    document.addEventListener('visibilitychange', () => {
    if (!isRunning && !document.hidden) tick(); // instant catch-up
  });
     updateDisplay();
     //Service Worker 
    
     if ('serviceWorker' in navigator) {
 window.addEventListener('load', () => {
    navigator.serviceWorker
    .register('../sw.js')
    .then( reg => console.log('Service Worker: Registered'))
    .catch(err => console.log(`Service Worker: Error: ${err}`))
 })
}
  </script>
</body>
</html>
